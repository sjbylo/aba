---
description: Critical rules for AI assistant working on the ABA project
alwaysApply: true
---

# ABA Project Rules (Always Active)

## NEVER commit or push without explicit user permission

- After making file edits, STOP. Show the user what changed. Ask: "Should I commit and push?"
- Do NOT proceed with git commit or git push until the user explicitly says to commit.
- "yes" to a file edit does NOT mean "yes, commit it" — it only means "yes, make the edit"
- Do NOT commit after making changes
- Do NOT commit when user says "ok", "yes", or "continue" (unless specifically about commits)
- Do NOT push to origin without being asked
- WAIT for user to explicitly say "commit", "push", or "commit and push"
- NEVER use required_permissions: ["all"] for git commit or git push — they must run inside the sandbox so Cursor's approval gate is enforced

## NEVER add AI attribution to commits

- No "Co-authored-by: Cursor" or similar tags in commit messages

## Git workflow

- Work on the `dev` branch
- Default: commit AND push together (unless told otherwise)
- Run `build/pre-commit-checks.sh` before committing code changes
- Run `build/pre-commit-checks.sh --skip-version` for docs-only commits

## Backup uncommitted changes before editing

- Before editing a file, check if it has uncommitted changes (`git diff --name-only`)
- If it does, back it up to `.backup/` preserving the path: `mkdir -p .backup/DIR && cp FILE .backup/DIR/`
- Example: `tui/foo.sh` backs up to `.backup/tui/foo.sh`
- Clean up `.backup/` after a successful commit
- `.backup/` is gitignored -- backups never get committed
- This guards against unexplained file reverts/deletions

## "Show me" means SHOW, not APPLY

- When user says "show me" a change, display it -- do not edit the file
- Only apply changes when user explicitly approves

## File modification permissions

- CAN modify freely: `test/func/*`, `ai/*`
- CAN modify with permission: `scripts/include_all.sh`, `scripts/aba.sh`
- CANNOT modify without explicit request: all other `scripts/*.sh`, Makefiles

## Coding style

- Use TABS for indentation, never spaces
- Empty lines must have NO characters (no trailing whitespace)
- Add comments for non-obvious bash features

## Key architecture

- Use `run_once()` for all task management -- never access `~/.aba/runner/` directly
- Use relative paths -- avoid `$ABA_ROOT` (only `aba.sh` should use it)
- Use `ensure_*()` functions for CLI tool installation
- Symlinks handle cross-directory access (scripts use same paths everywhere)

## E2E test golden rules

- Tests MUST fail on error -- never mask underlying issues
- Never use `2>/dev/null` or `|| true` in test commands (use `e2e_diag` for diagnostic-only commands, or explicit precondition checks)
- When a test fails, check if the fix belongs in ABA code FIRST -- never "fix" a test just to make it pass
- Uninstall from the same host that installed (e.g. registry installed from conN must be uninstalled from conN)
- Never remove tools before operations that need them (e.g. `dnf remove make` before `aba reset`)
- Verify cleanup actually worked (assert service is down, directory is gone)
- Prefer `aba` commands over raw `make` / scripts -- eat your own dog food

## For full details see `ai/RULES_OF_ENGAGEMENT.md`
