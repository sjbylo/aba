# =============================================================================
# E2E Test Framework -- Default Configuration
# =============================================================================
# Baseline defaults for all test runs. These can be overridden by:
#   1. Per-pool overrides in pools.conf
#   2. CLI flags passed to run.sh
#
# Precedence: CLI flags > pool overrides > config.env defaults
# =============================================================================

# --- Test parameters --------------------------------------------------------

TEST_CHANNEL=stable               # stable | fast | candidate
VER_OVERRIDE=l                    # l=latest | p=previous | x.y.z
INTERNAL_BASTION_RHEL_VER=rhel9   # rhel8 | rhel9 | rhel10
TEST_USER=steve                   # User on the internal bastion (any user or root)
OC_MIRROR_VER=v2                  # v1 (deprecated) | v2

# --- Environment ------------------------------------------------------------

ABA_TESTING=1                     # Disables usage tracking to api.counterapi.dev

# --- Timeouts ---------------------------------------------------------------

OPERATOR_WAIT_TIMEOUT=1800        # Seconds to wait for cluster operators to settle
SSH_WAIT_TIMEOUT=300              # Seconds to wait for SSH to become available
VM_BOOT_DELAY=8                   # Seconds to sleep after govc vm.power -on

# --- Notifications ----------------------------------------------------------

NOTIFY_CMD=~/bin/notify.sh        # Command for notifications (sends Telegram messages)

# --- VMware -----------------------------------------------------------------

VMWARE_CONF=~/.vmware.conf       # Path to govc configuration file
VC_FOLDER=/Datacenter/vm/abatesting  # vCenter folder for test VMs
VM_SNAPSHOT=aba-test              # Snapshot to revert source VMs to before cloning
VM_DATASTORE="Datastore4-2"       # Target datastore for clones (empty = same as template)
                                  # Per-pool override in pools.conf: VM_DATASTORE=datastore2

# --- Clone MAC Addresses ---------------------------------------------------
# After cloning, each clone's NICs must be set to specific MACs so that
# DHCP assigns the correct IP addresses (tied to DHCP reservations).
#
# All clones have 3 NICs (same source VM layout). Internal bastions
# simply don't use ens256 -- the NIC exists but has no route/config.
#
# Format: VM_CLONE_MACS[clone_name]="ens192-MAC ens224-MAC ens256-MAC"
#   Position 1 = ethernet-0 / ens192 (private lab, DHCP)
#   Position 2 = ethernet-1 / ens224 (VLAN, static IP)
#   Position 3 = ethernet-2 / ens256 (internet, DHCP -- unused on internal bastions)
#
# The VMware port group for each NIC is auto-detected from the clone.
#
# Numbering: 3 MACs per clone, 6 per pool. Pool N starts at (N-1)*6 + 1.
#
declare -gA VM_CLONE_MACS=(
    #                        ens192             ens224             ens256
    # Pool 1:
    [con1]="00:50:56:ac:01:01  00:50:56:ac:01:02  00:50:56:ac:01:03"
    [dis1]="00:50:56:ac:01:04  00:50:56:ac:01:05  00:50:56:ac:01:06"

    # Pool 2:
    [con2]="00:50:56:ac:02:01  00:50:56:ac:02:02  00:50:56:ac:02:03"
    [dis2]="00:50:56:ac:02:04  00:50:56:ac:02:05  00:50:56:ac:02:06"

    # Pool 3:
    [con3]="00:50:56:ac:03:01  00:50:56:ac:03:02  00:50:56:ac:03:03"
    [dis3]="00:50:56:ac:03:04  00:50:56:ac:03:05  00:50:56:ac:03:06"

    # Pool 4:
    [con4]="00:50:56:ac:04:01  00:50:56:ac:04:02  00:50:56:ac:04:03"
    [dis4]="00:50:56:ac:04:04  00:50:56:ac:04:05  00:50:56:ac:04:06"
)

# --- Clone Base Domain -----------------------------------------------------
# Hostnames follow convention: ${clone_name}.${VM_BASE_DOMAIN}
# e.g. con1.example.com, dis2.example.com
#
VM_BASE_DOMAIN=example.com

# --- Per-Pool Cluster Configuration ----------------------------------------
# Only ONE cluster type (SNO, compact, or standard) runs per pool at a time,
# so all cluster types share the same static IPs within a pool.
#
# Each pool gets a "decade" within 10.0.2.0/24:
#   Pool N: 10.0.2.(N*10) through 10.0.2.(N*10+9)
#     .x0 = conN bastion (DHCP)
#     .x1 = disN bastion (DHCP)
#     .x2 = cluster node / SNO IP / rendezvous IP
#     .x3 = API VIP (shared by compact + standard; unused for SNO)
#     .x4 = APPS VIP (shared by compact + standard; unused for SNO)
#     .x5-.x9 = spare
#
# For SNO: the node IP (.x2) is also the API + APPS endpoint.
# For compact/standard: .x2 is the rendezvous node, .x3/.x4 are the VIPs.
#
# Domain names use per-pool subdomains to avoid DNS collision:
#   Pool N -> pN.example.com
#   e.g. api.sno.p1.example.com, *.apps.compact.p2.example.com
#
# Machine network for all pools: 10.0.0.0/20 (shared L2 network)
#
POOL_SUBNET="10.0.2"            # /24 shared by all pools
POOL_MACHINE_NETWORK="10.0.0.0/20"
DNS_UPSTREAM="10.0.1.8"          # Lab DNS for non-cluster queries (dnsmasq forwarding)

declare -gA POOL_DOMAIN=(
    [1]="p1.example.com"
    [2]="p2.example.com"
    [3]="p3.example.com"
    [4]="p4.example.com"
)

# Cluster node / SNO IP / rendezvous IP (shared across cluster types)
declare -gA POOL_NODE_IP=(
    [1]="10.0.2.12"
    [2]="10.0.2.22"
    [3]="10.0.2.32"
    [4]="10.0.2.42"
)

# API VIP (used by compact + standard; for SNO = same as POOL_NODE_IP)
declare -gA POOL_API_VIP=(
    [1]="10.0.2.13"
    [2]="10.0.2.23"
    [3]="10.0.2.33"
    [4]="10.0.2.43"
)

# APPS/Ingress VIP (used by compact + standard; for SNO = same as POOL_NODE_IP)
declare -gA POOL_APPS_VIP=(
    [1]="10.0.2.14"
    [2]="10.0.2.24"
    [3]="10.0.2.34"
    [4]="10.0.2.44"
)

# --- VLAN Cluster Configuration (per-pool) ---------------------------------
# When testing VLAN-based cluster installs (suite-network-advanced), the cluster
# nodes are placed on the bastion's VLAN subnet (10.10.20.0/24).
# Each pool gets a unique node IP in the high range to avoid bastion IPs.
#
POOL_VLAN_NETWORK="10.10.20.0/24"

declare -gA POOL_VLAN_NODE_IP=(
    [1]="10.10.20.201"
    [2]="10.10.20.202"
    [3]="10.10.20.203"
    [4]="10.10.20.204"
)

# VLAN API VIP (for compact/standard on VLAN)
declare -gA POOL_VLAN_API_VIP=(
    [1]="10.10.20.211"
    [2]="10.10.20.212"
    [3]="10.10.20.213"
    [4]="10.10.20.214"
)

# VLAN APPS VIP (for compact/standard on VLAN)
declare -gA POOL_VLAN_APPS_VIP=(
    [1]="10.10.20.221"
    [2]="10.10.20.222"
    [3]="10.10.20.223"
    [4]="10.10.20.224"
)

# --- Clone VLAN IPs (static) -----------------------------------------------
# The 10.10.20.0/24 VLAN has NO DHCP. IPs must be statically assigned.
# This array defines the ens224.10 VLAN IP for each clone.
#
# Format: VM_CLONE_VLAN_IPS[clone_name]="IP/PREFIX"
#
declare -gA VM_CLONE_VLAN_IPS=(
    # Pool 1:
    [con1]="10.10.20.1/24"
    [dis1]="10.10.20.2/24"

    # Pool 2:
    [con2]="10.10.20.3/24"
    [dis2]="10.10.20.4/24"

    # Pool 3:
    [con3]="10.10.20.5/24"
    [dis3]="10.10.20.6/24"

    # Pool 4:
    [con4]="10.10.20.7/24"
    [dis4]="10.10.20.8/24"
)
